{"version":3,"file":"webStorage-bundled.cjs.js","mappings":"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","sources":["webpack://@tkey/web-storage/webpack/bootstrap","webpack://@tkey/web-storage/webpack/runtime/compat get default export","webpack://@tkey/web-storage/webpack/runtime/define property getters","webpack://@tkey/web-storage/webpack/runtime/hasOwnProperty shorthand","webpack://@tkey/web-storage/webpack/runtime/make namespace object","webpack://@tkey/web-storage/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@tkey/web-storage/external commonjs2 \"@tkey/common-types\"","webpack://@tkey/web-storage/./src/errors.ts","webpack://@tkey/web-storage/./src/utils.ts","webpack://@tkey/web-storage/./src/FileStorageHelpers.ts","webpack://@tkey/web-storage/./src/LocalStorageHelpers.ts","webpack://@tkey/web-storage/external commonjs2 \"bn.js\"","webpack://@tkey/web-storage/./src/WebStorageModule.ts","webpack://@tkey/web-storage/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@tkey/common-types\");","import { ErrorCodes, ITkeyError, TkeyError } from \"@tkey/common-types\";\n\nclass WebStorageError extends TkeyError {\n  protected static messages: ErrorCodes = {\n    3000: \"default\",\n    // module\n    3101: \"unableToReadFromStorage\",\n    // fileStorage\n    3201: \"No Share exists in file system\",\n    3202: \"No requestFileSystem\",\n    // localstorage\n    3301: \"Local storage is not enabled\",\n    3302: \"No share exists in localstorage\",\n  };\n\n  public constructor(code: number, message?: string) {\n    // takes care of stack and proto\n    super(code, message);\n    // Set name explicitly as minification can mangle class names\n    Object.defineProperty(this, \"name\", { value: \"WebStorageError\" });\n  }\n\n  public static fromCode(code: number, extraMessage = \"\"): ITkeyError {\n    return new WebStorageError(code, `${WebStorageError.messages[code]}${extraMessage}`);\n  }\n\n  public static default(extraMessage = \"\"): ITkeyError {\n    return new WebStorageError(3000, `${WebStorageError.messages[3000]}${extraMessage}`);\n  }\n\n  // Custom methods\n  public static unableToReadFromStorage(extraMessage = \"\"): ITkeyError {\n    return WebStorageError.fromCode(3101, extraMessage);\n  }\n\n  public static shareUnavailableInFileStorage(extraMessage = \"\"): ITkeyError {\n    return WebStorageError.fromCode(3201, extraMessage);\n  }\n\n  public static fileStorageUnavailable(extraMessage = \"\"): ITkeyError {\n    return WebStorageError.fromCode(3202, extraMessage);\n  }\n\n  public static localStorageUnavailable(extraMessage = \"\"): ITkeyError {\n    return WebStorageError.fromCode(3301, extraMessage);\n  }\n\n  public static shareUnavailableInLocalStorage(extraMessage = \"\"): ITkeyError {\n    return WebStorageError.fromCode(3302, extraMessage);\n  }\n}\nexport default WebStorageError;\n","export function getWindow(): Window {\n  if (typeof window !== \"undefined\") return window;\n\n  if (typeof self !== \"undefined\") return self;\n  throw new Error(\"Unable to locate window object.\");\n}\n","import { ShareStore } from \"@tkey/common-types\";\n\nimport WebStorageError from \"./errors\";\nimport { getWindow } from \"./utils\";\n\n// Web Specific declarations\nconst requestedBytes = 1024 * 1024 * 10; // 10MB\n\ndeclare global {\n  interface Navigator {\n    webkitPersistentStorage: {\n      requestQuota: (a: number, b: (grantedBytes: number) => void, c: (reason: string) => void) => unknown;\n    };\n  }\n}\n\nfunction download(filename: string, text: string): void {\n  const element = document.createElement(\"a\");\n  element.setAttribute(\"href\", `data:application/json;charset=utf-8,${encodeURIComponent(text)}`);\n  element.setAttribute(\"download\", filename);\n  element.style.display = \"none\";\n  document.body.appendChild(element);\n  element.click();\n  document.body.removeChild(element);\n}\nasync function requestQuota(): Promise<number> {\n  return new Promise((resolve, reject) => {\n    navigator.webkitPersistentStorage.requestQuota(requestedBytes, resolve, reject);\n  });\n}\nasync function browserRequestFileSystem(grantedBytes: number): Promise<FileSystem> {\n  return new Promise((resolve, reject) => {\n    const win = getWindow();\n    win.requestFileSystem = win.requestFileSystem || win.webkitRequestFileSystem;\n    win.requestFileSystem(win.PERSISTENT, grantedBytes, resolve, reject);\n  });\n}\nasync function getFile(fs: FileSystem, path: string, create: boolean): Promise<FileEntry> {\n  return new Promise<FileEntry>((resolve, reject) => {\n    fs.root.getFile(path, { create }, (data) => resolve(data as FileEntry), reject);\n  });\n}\nasync function readFile(fileEntry: FileEntry): Promise<File> {\n  return new Promise((resolve, reject) => {\n    fileEntry.file(resolve, reject);\n  });\n}\n\nexport const getShareFromFileStorage = async (key: string): Promise<ShareStore> => {\n  const win = getWindow();\n  win.requestFileSystem = win.requestFileSystem || win.webkitRequestFileSystem;\n  if (win.requestFileSystem) {\n    const fs = await browserRequestFileSystem(requestedBytes);\n\n    const fileEntry = await getFile(fs, key, false);\n    const file = await readFile(fileEntry);\n    const fileStr = await file.text();\n    if (!fileStr) {\n      throw WebStorageError.shareUnavailableInFileStorage();\n    }\n    return ShareStore.fromJSON(JSON.parse(fileStr));\n  }\n  throw WebStorageError.fileStorageUnavailable();\n};\n\nexport const storeShareOnFileStorage = async (share: ShareStore, key: string): Promise<void> => {\n  // if we're on chrome (thus window.requestFileSystem exists) we use it\n  const fileName = `${key}.json`;\n  const fileStr = JSON.stringify(share);\n  const win = getWindow();\n  win.requestFileSystem = win.requestFileSystem || win.webkitRequestFileSystem;\n  if (win.requestFileSystem) {\n    const grantedBytes = await requestQuota();\n    const fs = await browserRequestFileSystem(grantedBytes);\n    const fileEntry = await getFile(fs, key, true);\n    await new Promise((resolve, reject) => {\n      fileEntry.createWriter((fileWriter) => {\n        fileWriter.onwriteend = resolve;\n        fileWriter.onerror = reject;\n        const bb = new Blob([fileStr], { type: \"application/json\" });\n        fileWriter.write(bb);\n      }, reject);\n    });\n  } else {\n    // we make the user download a file\n    download(fileName, fileStr);\n  }\n};\n\nexport const canAccessFileStorage = async (): Promise<PermissionStatus> => navigator.permissions.query({ name: \"persistent-storage\" });\n","import { ShareStore } from \"@tkey/common-types\";\n\nimport WebStorageError from \"./errors\";\nimport { getWindow } from \"./utils\";\n\nconst win = getWindow();\n\nfunction storageAvailable(type: string): boolean {\n  let storage: Storage;\n  try {\n    storage = win[type];\n    const x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (e) {\n    return (\n      e instanceof DOMException &&\n      // everything except Firefox\n      (e.code === 22 ||\n        // Firefox\n        e.code === 1014 ||\n        // test name field too, because code might not be present\n        // everything except Firefox\n        e.name === \"QuotaExceededError\" ||\n        // Firefox\n        e.name === \"NS_ERROR_DOM_QUOTA_REACHED\") &&\n      // acknowledge QuotaExceededError only if there's something already stored\n      storage &&\n      storage.length !== 0\n    );\n  }\n}\n\nexport const storeShareOnLocalStorage = async (share: ShareStore, key: string): Promise<void> => {\n  const fileStr = JSON.stringify(share);\n  if (!storageAvailable(\"localStorage\")) {\n    throw WebStorageError.localStorageUnavailable();\n  }\n  win.localStorage.setItem(key, fileStr);\n};\n\nexport const getShareFromLocalStorage = async (key: string): Promise<ShareStore> => {\n  if (!storageAvailable(\"localStorage\")) {\n    throw WebStorageError.localStorageUnavailable();\n  }\n  const foundFile = win.localStorage.getItem(key);\n  if (!foundFile) throw WebStorageError.shareUnavailableInLocalStorage();\n  return ShareStore.fromJSON(JSON.parse(foundFile));\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"bn.js\");","import { BNString, DeviceShareDescription, IModule, ITKeyApi, prettyPrintError, ShareStore, StringifiedType } from \"@tkey/common-types\";\nimport BN from \"bn.js\";\n\nimport WebStorageError from \"./errors\";\nimport { canAccessFileStorage, getShareFromFileStorage, storeShareOnFileStorage } from \"./FileStorageHelpers\";\nimport { getShareFromLocalStorage, storeShareOnLocalStorage } from \"./LocalStorageHelpers\";\n\nexport const WEB_STORAGE_MODULE_NAME = \"webStorage\";\n\nclass WebStorageModule implements IModule {\n  moduleName: string;\n\n  tbSDK: ITKeyApi;\n\n  canUseFileStorage: boolean;\n\n  constructor(canUseFileStorage = true) {\n    this.moduleName = WEB_STORAGE_MODULE_NAME;\n    this.canUseFileStorage = canUseFileStorage;\n    this.setFileStorageAccess();\n  }\n\n  async setFileStorageAccess(): Promise<void> {\n    try {\n      const result = await canAccessFileStorage();\n      if (result.state === \"denied\") {\n        this.canUseFileStorage = false;\n      } else if (result.state === \"granted\") {\n        this.canUseFileStorage = true;\n      }\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      const self = this;\n      result.onchange = function permissionChange() {\n        if (this.state === \"denied\") {\n          self.canUseFileStorage = false;\n        } else if (this.state === \"granted\") {\n          self.canUseFileStorage = true;\n        }\n      };\n    } catch (error) {}\n  }\n\n  setModuleReferences(tbSDK: ITKeyApi): void {\n    this.tbSDK = tbSDK;\n    this.tbSDK._setDeviceStorage(this.storeDeviceShare.bind(this));\n  }\n\n  // eslint-disable-next-line\n  async initialize(): Promise<void> {}\n\n  async storeDeviceShare(deviceShareStore: ShareStore, customDeviceInfo?: StringifiedType): Promise<void> {\n    const metadata = this.tbSDK.getMetadata();\n    const tkeypubx = metadata.pubKey.x.toString(\"hex\");\n    await storeShareOnLocalStorage(deviceShareStore, tkeypubx);\n    const shareDescription: DeviceShareDescription = {\n      module: this.moduleName,\n      userAgent: navigator.userAgent,\n      dateAdded: Date.now(),\n    };\n    if (customDeviceInfo) {\n      shareDescription.customDeviceInfo = JSON.stringify(customDeviceInfo);\n    }\n    await this.tbSDK.addShareDescription(deviceShareStore.share.shareIndex.toString(\"hex\"), JSON.stringify(shareDescription), true);\n  }\n\n  async storeDeviceShareOnFileStorage(shareIndex: BNString): Promise<void> {\n    const metadata = this.tbSDK.getMetadata();\n    const tkeypubx = metadata.pubKey.x.toString(\"hex\");\n    const shareStore = this.tbSDK.outputShareStore(new BN(shareIndex));\n    return storeShareOnFileStorage(shareStore, tkeypubx);\n  }\n\n  async getDeviceShare(): Promise<ShareStore> {\n    const metadata = this.tbSDK.getMetadata();\n    const tkeypubx = metadata.pubKey.x.toString(\"hex\");\n    let shareStore: ShareStore;\n    try {\n      shareStore = await getShareFromLocalStorage(tkeypubx);\n    } catch (localErr) {\n      if (this.canUseFileStorage) {\n        try {\n          shareStore = await getShareFromFileStorage(tkeypubx);\n        } catch (fileErr) {\n          if (fileErr?.message?.includes(\"storage quota\")) {\n            // User has denied access to storage. stop asking for every share\n            this.canUseFileStorage = false;\n          }\n          throw WebStorageError.unableToReadFromStorage(\n            `Error inputShareFromWebStorage: ${prettyPrintError(localErr)} and ${prettyPrintError(fileErr)}`\n          );\n        }\n      }\n      throw WebStorageError.unableToReadFromStorage(`Error inputShareFromWebStorage: ${prettyPrintError(localErr)}`);\n    }\n    return shareStore;\n  }\n\n  async inputShareFromWebStorage(): Promise<void> {\n    const shareStore = await this.getDeviceShare();\n    let latestShareStore = shareStore;\n    const metadata = this.tbSDK.getMetadata();\n    if (metadata.getLatestPublicPolynomial().getPolynomialID() !== shareStore.polynomialID) {\n      latestShareStore = (await this.tbSDK.catchupToLatestShare({ shareStore, includeLocalMetadataTransitions: true })).latestShare;\n      const tkeypubx = metadata.pubKey.x.toString(\"hex\");\n      await storeShareOnLocalStorage(latestShareStore, tkeypubx);\n    }\n    this.tbSDK.inputShareStore(latestShareStore);\n  }\n}\n\nexport default WebStorageModule;\n","export { default as WebStorageError } from \"./errors\";\nexport * from \"./FileStorageHelpers\";\nexport * from \"./LocalStorageHelpers\";\nexport { default, WEB_STORAGE_MODULE_NAME, default as WebStorageModule } from \"./WebStorageModule\";\n"],"names":["TkeyError","WebStorageError","constructor","code","message","Object","defineProperty","value","fromCode","extraMessage","arguments","length","undefined","messages","default","unableToReadFromStorage","shareUnavailableInFileStorage","fileStorageUnavailable","localStorageUnavailable","shareUnavailableInLocalStorage","_defineProperty","getWindow","window","self","Error","ShareStore","requestedBytes","download","filename","text","element","document","createElement","setAttribute","encodeURIComponent","style","display","body","appendChild","click","removeChild","requestQuota","Promise","resolve","reject","navigator","webkitPersistentStorage","browserRequestFileSystem","grantedBytes","win","requestFileSystem","webkitRequestFileSystem","PERSISTENT","getFile","fs","path","create","root","data","readFile","fileEntry","file","getShareFromFileStorage","key","fileStr","fromJSON","JSON","parse","storeShareOnFileStorage","share","fileName","stringify","createWriter","fileWriter","onwriteend","onerror","bb","Blob","type","write","canAccessFileStorage","permissions","query","name","storageAvailable","storage","x","setItem","removeItem","e","DOMException","storeShareOnLocalStorage","localStorage","getShareFromLocalStorage","foundFile","getItem","prettyPrintError","BN","WEB_STORAGE_MODULE_NAME","WebStorageModule","canUseFileStorage","moduleName","setFileStorageAccess","result","state","onchange","permissionChange","error","setModuleReferences","tbSDK","_setDeviceStorage","storeDeviceShare","bind","initialize","deviceShareStore","customDeviceInfo","metadata","getMetadata","tkeypubx","pubKey","toString","shareDescription","module","userAgent","dateAdded","Date","now","addShareDescription","shareIndex","storeDeviceShareOnFileStorage","shareStore","outputShareStore","getDeviceShare","localErr","fileErr","_fileErr$message","includes","inputShareFromWebStorage","latestShareStore","getLatestPublicPolynomial","getPolynomialID","polynomialID","catchupToLatestShare","includeLocalMetadataTransitions","latestShare","inputShareStore"],"sourceRoot":""}